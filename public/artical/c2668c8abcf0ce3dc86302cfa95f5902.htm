<!DOCTYPE html>
        <html><head>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <meta charset="utf-8">
        <meta property="og:type" content="article">
        <meta property="og:locale" content="zh_CN">
        <meta property="og:description" content="上周有外媒爆出了一个和Google隐私安全有关的小瓜。事儿本身不大，但聊一聊还是蛮有意思的。报道讲说，Google自家的Pixel手机系统内置的“Markup”截图工具，存在一个严重的隐私漏洞。只要你通过这个截图工具来剪辑PNG格式的图片，就有一定概率还原出原图被截掉的其他信息……">
        <meta property="og:site_name" content="x.liuping.win">
        <meta property="og:image" content="https://x.liuping.win/img/30a163b480ad11729e49cd1561d2b501.webp">
        <meta property="og:url" content="https://x.liuping.win/artical/c2668c8abcf0ce3dc86302cfa95f5902.htm">
        <meta property="og:title" content="打过码的图片等于没打 用Windows截图工具的要小心了 - x.liuping.win">
        <meta name="keywords" content="Microsoft Error,打过码的图片等于没打 用Windows截图工具的要小心了,x.liuping.win">
        <meta name="description" content="上周有外媒爆出了一个和Google隐私安全有关的小瓜。事儿本身不大，但聊一聊还是蛮有意思的。报道讲说，Google自家的Pixel手机系统内置的“Markup”截图工具，存在一个严重的隐私漏洞。只要你通过这个截图工具来剪辑PNG格式的图片，就有一定概率还原出原图被截掉的其他信息……">
        <title>打过码的图片等于没打 用Windows截图工具的要小心了</title>
        <style>img {max-width: 90%;} body {text-align: center;}</style>
        </head>
        <body><h1>打过码的图片等于没打 用Windows截图工具的要小心了</h1><p>上周有外媒爆出了一个和Google隐私安全有关的小瓜。事儿本身不大，但聊一聊还是蛮有意思的。报道讲说，Google自家的 Pixel 
手机系统内置的 “ Markup ” 截图工具，存在一个严重的隐私漏洞。只要你通过这个截图工具来剪辑 PNG 
格式的图片，就有一定概率还原出原图被截掉的其他信息……</p><hr><div class="article-content" id="artibody">
<p><img src="https://x.liuping.win/img/30a163b480ad11729e49cd1561d2b501.webp"/><br/></p><p>发现这个漏洞的程序员 Simon Aarons，还写了一个可以检测这个漏洞的程序 Acropalypse。</p><p><img src="https://x.liuping.win/img/8bdc6b33771f23ce00f996746fe6604b.webp"/><br/></p><p>只要你把 Pixel 手机的机型和用 Markup 裁出的上传上去，就能得到原图的其他信息。</p><p>世超拿 Pixel 4 试了一下，效果拔群……</p><p><img src="https://x.liuping.win/img/c8260f6d5611c1203bd19aba476051a1.webp"/><br/></p><p>一石激起千层浪啊，Google这事儿被爆出来之后，被一群码农大佬们顺藤摸瓜，发现类似的 Bug，微软似乎也有份。</p><p>他们直接使用 Windows 系统重的截图工具，也重现了和GooglePixel 一样的问题。</p><p><img src="https://x.liuping.win/img/5f2a0d10c55123b0f9459b6ca69deb75.webp"/><br/></p><p><strong>这下问题就大条了。</strong></p><p>要说 Pixel 手机用的人少和咱们关系也不大，可 Windows 的截图工具，可是大伙儿经常会摸到的常用工具。</p><p><strong>数以十亿计的用户，可能在自以为隐私部分已经抹掉了的情况下，把截图发了出去。</strong></p><p>但凡有什么个人隐私信息，想想都觉得后脊背发凉。</p><p>那世超就好奇了，两家大厂，在两个毫不相关的系统上，出现了一模一样的严重错误……</p><p>难道是 PNG 的标准实在是太老被钻了漏洞，或者是什么基础软件有问题？</p><p><img src="https://x.liuping.win/img/3388ec578660c19de029bcec72f101d7.webp"/><br/></p><p>世超怀着揣揣不安的心情，深入调查了一下这件事儿的来龙去脉。</p><p>先说结论啊：<strong>并不是图像处理和储存的标准出了问题，而是Google微软同时以不同的方式犯了傻。</strong></p><p><img src="https://x.liuping.win/img/c3f9bbc16fe65deeebc61524d84cc993.webp"/><br/></p><p>首先说明一下，这个 Bug 的真正原因，并不是 PNG 透明通道（ RGBA中的A ）的问题。</p><p>这个有歧义的新闻让世超原地研究半小时，下为原文</p><p><img src="https://x.liuping.win/img/63aa71834b4100c71610f54e3f69a72f.webp"/><br/></p><p><img src="https://x.liuping.win/img/c6d611ca6375836cceaf66cc511e5c5d.webp"/><br/></p><p>简单来说，这个 Bug 的本质，其实是因为截图工具<strong>没有删除旧图片数据，而是直接把新图片，覆盖写入在了旧图片的开头。</strong></p><p>所以只要新的图片文件大小<strong>小于旧文件，没完全用数据把原图覆盖掉，</strong>就留下了可恢复的旧图像数据。</p><p><img src="https://x.liuping.win/img/f208286bad9285cacdf4cc88bc0c34dc.webp"/><br/></p><p>而标准的 PNG 解码器，在读到新 PNG 文件尾的时候，就不会再读下去了，所以剩余的旧数据，会被解码器直接忽略。</p><p><img src="https://x.liuping.win/img/6c812c86683eadbd53a0ff2d5cde86b6.webp"/><br/></p><p>这也是用户很难发现旧图片数据泄露的原因：不用特别手段，一般人根本看不出。</p><p>不过，虽说问题的本质一样，但这两个大厂出问题的理由却并不相同。</p><p>Google是因为 Android 9 到 Android 10 的时候，读写文件相关的一个接口发生了变动，而且没有记载在文档和更新日志里。</p><p><img src="https://x.liuping.win/img/6197f6852176386264b018b9a9b6a80b.webp"/><br/></p><p>祖传的代码在旧接口上会正确删除旧文件，不会留下<strong>只因脚</strong>。</p><p>然而在新版本下，同样的代码就只能覆盖写入旧文件，只要新文件小于旧文件，旧文件的残余部分就会留下来。</p><p><img src="https://x.liuping.win/img/0a37203927e7e1bd62c2df273888d20e.webp"/><br/></p><p><strong>而微软这边的问题可能要更大些……</strong></p><p>根据微软的 API 规则，程序员在调用覆盖文件的接口时，如果没有<strong>额外的特别指示 Windows 把旧文件删掉，</strong>那么新文件就会直接从头开始覆盖旧文件，然后留下一堆旧文件的残余。</p><p>但凡程序员在写的时候没注意到这个规则，就会有安全风险……</p><p>至于微软为何要把这种不安全的行为作为接口的默认值，世超只能说，或许这就是国际大厂对编程的精妙理解吧。</p><p>好消息：微软的接口一直都没变过；坏消息：但是设计的和狗屎一样。</p><p><img src="https://x.liuping.win/img/dc19274eb98cfb93df1a459be44f09a6.webp"/><br/></p><p>严重的是，随着这个漏洞原因的公开，已经有人在更加常用的 JPG 格式的图像上发现了类似的问题。</p><p>考虑到大多数截屏和手机拍照都是 JPG 直出，漏洞扩展到 JPG 后，这个问题其实是是扩散了。</p><p>而且由于 JPG 和 PNG 的压缩方式不同，文件头部被覆盖的 JPG 旧文件，<strong>搞不好还能实现几乎完美的还原……</strong></p><p>还原的JPG图像只是比原图多了点噪点</p><p><img src="https://x.liuping.win/img/6220146f209df704f54eacdf5f5da5cd.webp"/><br/></p><p>这 Bug，好像有那么点刹不住车了……</p><p>好消息是，如今信息安全的概念已经深入人心，<strong>在我们的隐私完全漏勺之前，其实还有一道防线。</strong></p><p>世超在当年试图成为一个程序猿的时候，学到的第一课，就是<strong>绝对不能信任用户提交的数据。</strong></p><p>用户试图删掉网站的用户数据表</p><p><img src="https://x.liuping.win/img/baeab98060f2f80bd79d93138df7cd17.webp"/><br/></p><p>一些技术人员甚至可以利用解码器 <strong>“ 只读取文件尾之前数据 ” </strong>的特性，在一张正常图片的尾部附带恶意代码，从而攻击网站服务器或其他用户。</p><p>之前在贴吧里流行过的图种也是类似原理。</p><p><img src="https://x.liuping.win/img/6afd86ba53222efe12d41b3d62d522bd.webp"/><br/></p><p>为了清除这些可能有风险的无关数据，同时节约服务器流量和存储，一般网站都会<strong>先用解码器读取图片，然后重新编码成低质量的 JPG。</strong></p><p>这样，即使是用户上传的图片里有额外数据（ 比如这次 Bug 留下来的旧图 ），也不会出现在其他用户那里。</p><p><img lazyload="https://x0.ifengimg.com/res/2023/E261399CA540B27E95F5D686CA10674D3C0997F0_size53_w1080_h600.jpg" src="https://x.liuping.win/img/7eb812d819cfe720d4e372264f7790a4.jpg"/><br/></p><p><strong>但也有例外。</strong></p><p>比如说，微信和 Discord 就提供<strong>下载原图</strong>的选项，而且提供的是真正的原图。这样，那些无关数据就还是公开了。</p><p>按照安全原则，他们应当提供 “ 伪原图 ”</p><p><img lazyload="https://x0.ifengimg.com/res/2023/F4EDDA90FD9077808EA50E187D5E4F22CA9D0197_size63_w1080_h600.jpg" src="https://x.liuping.win/img/5a07ed5066df4d3ef0b2e5dab3ca6b02.jpg"/><br/></p><p>总结一下，Google和微软这次的 Bug，是两个<strong>影响相当广泛、原因极其简单、后果控制不好可能会严重</strong>的漏洞。</p><p>其中一个从 Android 10（2019）开始，影响所有 Pixel 手机；</p><p>另一个从 Windows 10 （2015）开始，影响所有使用系统自带截图工具的用户。</p><p>更离谱的是，这两个漏洞前几天才刚刚修复……</p><p>世超觉得，考虑到时间跨度、受害者数量和形成原因，这两个漏洞完全有资格参与 <strong>“ 年度最弱智漏洞 ”</strong> 的竞争。</p><p>但不管怎么样，在关系到用户隐私信息这一块的问题，Google和微软确实应该加强代码的检查。</p><p>各家互联网平台运营商，也应该以此为戒，<strong>避免在公共场合分发原始图片的原文件，</strong>这不仅可能损害自家服务器的安全，而且还可能暴露用户的隐私。</p><p>原图信息中甚至还能有地点定位信息</p><p><img lazyload="https://x0.ifengimg.com/res/2023/406233EFFEEECD9E626984CC4027DBA9982C0FFB_size190_w1080_h2340.png" src="https://x.liuping.win/img/5ec81e927208c68b1ef185121d917ca4.png"/><br/></p><p>从咱们用户自己的角度来说，世超的建议也很简单：在任何公开平台都<strong>不要上传原图！不要上传原图！不要上传原图！</strong></p><p><img lazyload="https://x0.ifengimg.com/res/2023/DBBB4B34778DA255C940B0717C450F3F017DCEB4_size5_w1080_h152.jpg" src="https://x.liuping.win/img/a9b36aa4606af4444f26c1437686106c.jpg"/><br/></p><p><strong>当图片经过在本地完成解码 —— 重新编码上传的过程，</strong>原图上的信息自然也就会被处理。</p><p>安全这块儿，还得是自己把住最后一关……</p> </div></body>
        </html>